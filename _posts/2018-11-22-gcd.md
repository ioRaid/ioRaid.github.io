---
layout: post
title: GCD深入理解
categories: [oc]
tags: [oc]
description: GCD
---

<h3>队列</h3>

{% highlight ruby %}

队列有：串行、并行

主队列属于串行队列，也由系统创建，只不过运行在主线程（UI线程）

全局队列属于并行队列，只不过已由系统创建的没有名字，且在全局可见（可用）


{% endhighlight %}


<h3>dispatch_async和dispatch_sync的区别</h3>

{% highlight ruby %}

     以下代码在主线程中运行
    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{
         NSLog(@"async%@",[NSThread currentThread]);
    });
    
    dispatch_sync(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{
        NSLog(@"sync%@",[NSThread currentThread]);
    });
    //输出：
       sync<NSThread: 0x60000356a900>{number = 1, name = main}
       async<NSThread: 0x60000350f9c0>{number = 3, name = (null)}

dispatch_sync：调用dispatch_sync的线程会等dispatch_sync的对内容执行完再继续执行

dispatch_async:调用 dispatch_async的线程不会等dispatch_async的内容执行，自己继续执行

区别：
调用dispatch的线程是否等待dispatch执行完
同步执行（sync）：只能在当前线程中执行任务，不具备开启新线程的能力
异步执行（async）：可以在新的线程中执行任务，具备开启新线程的能力

{% endhighlight %}




<h3>死锁</h3>

{% highlight ruby %}

 以下代码在主线程中运行

dispatch_sync(dispatch_get_main_queue (), ^{
      NSLog(@"dispatch_sync%@",[NSThread currentThread]);
});

1、sync函数会阻塞当前队列，等待block

2、dispatch_get_main_queue 为串行队列

3、block 被追加到当前queue的队尾等待被执行（当前为串行main_queue）

syn函数阻塞队列等待block执行返回，而block是被放入main_queue队尾，要等待main_queue执行完毕，而main_queue被syn函数阻塞。

{% endhighlight %}

<h3></h3>

{% highlight ruby %}


{% endhighlight %}

<a href="" target="_blank">参考</a>
